<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.koreait.koreaitsugang.repository.SugangRepository">

    <select id="searchCategory" parameterType="string" resultType="com.koreait.koreaitsugang.entity.ClassificationView">
        select
            classification_id,
            classification
        from
            classification_view
    </select>

    <select id="searchTotalCourse"
            parameterType="com.koreait.koreaitsugang.web.dto.SearchSugangReqDto"
            resultType="integer">
        select
            count(*)
        from
            subject_mst
        where
        1 = 1
        <if test='classification != null and classification !=""'>
            and classification = #{classification}
        </if>
        <if test='searchValue != null and searchValue != ""'>
            and classification like concat('%', #{searchValue}, '%')
        </if>
    </select>

    <select id="searchCourse"
            parameterType="com.koreait.koreaitsugang.web.dto.SearchSugangReqDto"
            resultType="com.koreait.koreaitsugang.entity.OpenCourse">
        select
            classification,
            subject_code as subjectCode,
            subject_name as subjectName,
            credit,
            professor_name as professorName,
            lecture_time as lectureTime,
            building
        from
            subject_mst
        where
        1 = 1
        <if test='searchValue != null and searchValue != ""'>
            and classification like concat('%', #{searchValue}, '%')
        </if>
        <if test='classification != null'>
            and classification in
            <foreach collection="classification" item="categoryName" open="(" close=")" separator=",">
                #{categoryName}
            </foreach>
        </if>
        <if test='limit == "Y"'>
            limit #{index}, #{count};
        </if>
    </select>

    <select id="availabilityApply" resultType="integer">
        select
            count(*)
        from
            pocket_mst
        where
            subject_code = #{subjectCode}
    </select>

    <insert id="saveCourse"
            parameterType="com.koreait.koreaitsugang.entity.PocketMst">
        insert into pocket_mst
        values (0, #{subjectCode}, #{userId})
    </insert>

</mapper>